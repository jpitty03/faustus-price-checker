{"ast":null,"code":"import React,{useEffect,useState}from\"react\";import AppBar from\"@mui/material/AppBar\";import Toolbar from\"@mui/material/Toolbar\";import Typography from\"@mui/material/Typography\";import{Box,CircularProgress,Chip,IconButton}from\"@mui/material\";import RefreshIcon from\"@mui/icons-material/Refresh\";import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";function HeaderBar(){const[divineOrbPrice,setDivineOrbPrice]=useState(null);const[isActive,setIsActive]=useState(false);const[loading,setLoading]=useState(true);const[lastCreated,setLastCreated]=useState(null);// Track last created time\n// Function to fetch the latest JSON and update state\nconst checkSiteStatus=async()=>{try{const response=await fetch(\"/faustus-price-checker/currencyOverview.json\");const data=await response.json();// Extract the \"created\" timestamp\nconst createdDate=data.created?new Date(data.created):null;// Extract Divine Orb price\nconst divineOrb=data.lines.find(line=>line.currencyTypeName===\"Divine Orb\");const price=divineOrb?divineOrb.chaosEquivalent:\"N/A\";setDivineOrbPrice(price);// Convert created date to PST\nconst createdDatePST=createdDate?new Date(createdDate.toLocaleString(\"en-US\",{timeZone:\"America/Los_Angeles\"})):null;// Determine if the site is \"active\" (created within the last 10 minutes)\nconst now=new Date();const tenMinutesAgo=new Date(now.getTime()-10*60*1000);const isNowActive=createdDatePST>tenMinutesAgo;// Update state only if the created date has changed\nif(lastCreated!==createdDatePST){setIsActive(isNowActive);setLastCreated(createdDatePST);}setLoading(false);}catch(error){console.error(\"Error checking site status:\",error);setLoading(false);}};// Auto-refresh every 15 seconds\nuseEffect(()=>{checkSiteStatus();// Fetch immediately on mount\nconst intervalId=setInterval(checkSiteStatus,15000);// Poll every 15 sec\nreturn()=>clearInterval(intervalId);// Cleanup interval on unmount\n},[lastCreated]);// Runs whenever lastCreated changes\nreturn/*#__PURE__*/_jsx(AppBar,{position:\"static\",children:/*#__PURE__*/_jsxs(Toolbar,{children:[/*#__PURE__*/_jsx(Typography,{variant:\"h6\",sx:{flexGrow:1},children:\"Faustus Price Checker\"}),loading?/*#__PURE__*/_jsx(CircularProgress,{color:\"inherit\",size:24}):/*#__PURE__*/_jsxs(_Fragment,{children:[divineOrbPrice&&/*#__PURE__*/_jsx(Box,{sx:{marginRight:2},children:/*#__PURE__*/_jsxs(Typography,{variant:\"body1\",children:[\"Divine Orb Price: \",divineOrbPrice,\" Chaos Orbs\"]})}),/*#__PURE__*/_jsx(Chip,{label:isActive?\"Active\":\"Inactive\",color:isActive?\"success\":\"error\",sx:{fontWeight:\"bold\",marginRight:2}}),/*#__PURE__*/_jsx(IconButton,{color:\"inherit\",onClick:checkSiteStatus,children:/*#__PURE__*/_jsx(RefreshIcon,{})})]})]})});}export default HeaderBar;","map":{"version":3,"names":["React","useEffect","useState","AppBar","Toolbar","Typography","Box","CircularProgress","Chip","IconButton","RefreshIcon","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","HeaderBar","divineOrbPrice","setDivineOrbPrice","isActive","setIsActive","loading","setLoading","lastCreated","setLastCreated","checkSiteStatus","response","fetch","data","json","createdDate","created","Date","divineOrb","lines","find","line","currencyTypeName","price","chaosEquivalent","createdDatePST","toLocaleString","timeZone","now","tenMinutesAgo","getTime","isNowActive","error","console","intervalId","setInterval","clearInterval","position","children","variant","sx","flexGrow","color","size","marginRight","label","fontWeight","onClick"],"sources":["C:/Users/jpitt/VSCode/faustus-price-checker/web-ui/src/components/HeaderBar.jsx"],"sourcesContent":["import React, { useEffect, useState } from \"react\";\r\nimport AppBar from \"@mui/material/AppBar\";\r\nimport Toolbar from \"@mui/material/Toolbar\";\r\nimport Typography from \"@mui/material/Typography\";\r\nimport { Box, CircularProgress, Chip, IconButton } from \"@mui/material\";\r\nimport RefreshIcon from \"@mui/icons-material/Refresh\";\r\n\r\nfunction HeaderBar() {\r\n  const [divineOrbPrice, setDivineOrbPrice] = useState(null);\r\n  const [isActive, setIsActive] = useState(false);\r\n  const [loading, setLoading] = useState(true);\r\n  const [lastCreated, setLastCreated] = useState(null); // Track last created time\r\n\r\n  // Function to fetch the latest JSON and update state\r\n  const checkSiteStatus = async () => {\r\n    try {\r\n      const response = await fetch(\"/faustus-price-checker/currencyOverview.json\");\r\n      const data = await response.json();\r\n\r\n      // Extract the \"created\" timestamp\r\n      const createdDate = data.created ? new Date(data.created) : null;\r\n\r\n      // Extract Divine Orb price\r\n      const divineOrb = data.lines.find(\r\n        (line) => line.currencyTypeName === \"Divine Orb\"\r\n      );\r\n      const price = divineOrb ? divineOrb.chaosEquivalent : \"N/A\";\r\n      setDivineOrbPrice(price);\r\n\r\n      // Convert created date to PST\r\n      const createdDatePST = createdDate\r\n        ? new Date(createdDate.toLocaleString(\"en-US\", { timeZone: \"America/Los_Angeles\" }))\r\n        : null;\r\n\r\n      // Determine if the site is \"active\" (created within the last 10 minutes)\r\n      const now = new Date();\r\n      const tenMinutesAgo = new Date(now.getTime() - 10 * 60 * 1000);\r\n      const isNowActive = createdDatePST > tenMinutesAgo;\r\n\r\n      // Update state only if the created date has changed\r\n      if (lastCreated !== createdDatePST) {\r\n        setIsActive(isNowActive);\r\n        setLastCreated(createdDatePST);\r\n      }\r\n\r\n      setLoading(false);\r\n    } catch (error) {\r\n      console.error(\"Error checking site status:\", error);\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  // Auto-refresh every 15 seconds\r\n  useEffect(() => {\r\n    checkSiteStatus(); // Fetch immediately on mount\r\n\r\n    const intervalId = setInterval(checkSiteStatus, 15000); // Poll every 15 sec\r\n\r\n    return () => clearInterval(intervalId); // Cleanup interval on unmount\r\n  }, [lastCreated]); // Runs whenever lastCreated changes\r\n\r\n  return (\r\n    <AppBar position=\"static\">\r\n      <Toolbar>\r\n        <Typography variant=\"h6\" sx={{ flexGrow: 1 }}>\r\n          Faustus Price Checker\r\n        </Typography>\r\n\r\n        {loading ? (\r\n          <CircularProgress color=\"inherit\" size={24} />\r\n        ) : (\r\n          <>\r\n            {divineOrbPrice && (\r\n              <Box sx={{ marginRight: 2 }}>\r\n                <Typography variant=\"body1\">\r\n                  Divine Orb Price: {divineOrbPrice} Chaos Orbs\r\n                </Typography>\r\n              </Box>\r\n            )}\r\n            <Chip\r\n              label={isActive ? \"Active\" : \"Inactive\"}\r\n              color={isActive ? \"success\" : \"error\"}\r\n              sx={{ fontWeight: \"bold\", marginRight: 2 }}\r\n            />\r\n            {/* Manual Refresh Button */}\r\n            <IconButton color=\"inherit\" onClick={checkSiteStatus}>\r\n              <RefreshIcon />\r\n            </IconButton>\r\n          </>\r\n        )}\r\n      </Toolbar>\r\n    </AppBar>\r\n  );\r\n}\r\n\r\nexport default HeaderBar;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}